{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/app/providers/ThemeProvider.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { ThemeProvider } from 'next-themes'\r\n\r\nexport function ProviderForTheme({ children }: { children: React.ReactNode }) {\r\n\treturn (\r\n\t\t<ThemeProvider attribute='class' defaultTheme='light' enableSystem={false}>\r\n\t\t\t{children}\r\n\t\t</ThemeProvider>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIO,SAAS,iBAAiB,EAAE,QAAQ,EAAiC;IAC3E,qBACC,6LAAC,oKAAa;QAAC,WAAU;QAAQ,cAAa;QAAQ,cAAc;kBAClE;;;;;;AAGJ;KANgB"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///app/src/shared/api/base.ts"],"sourcesContent":["import axios from 'axios'\r\nimport { toast } from 'sonner'\r\n\r\nexport const api = axios.create({\r\n\tbaseURL: process.env.NEXT_PUBLIC_API_URL,\r\n\twithCredentials: true,\r\n})\r\n\r\napi.interceptors.response.use(\r\n\t(response) => {\r\n\t\treturn response\r\n\t},\r\n\t(error) => {\r\n\t\tconst serverData = error.response?.data\r\n\t\tconst message =\r\n\t\t\tserverData?.error?.message || 'Произошла непредвиденная ошибка'\r\n\t\tconst statusCode = serverData?.statusCode\r\n\t\tconst isAuthMe = error.config.url.includes('/auth/me')\r\n\t\tif (statusCode === 429) {\r\n\t\t\ttoast.error('Слишком много запросов. Подождите минуту.')\r\n\t\t} else if (statusCode === 401 && !isAuthMe) {\r\n\t\t\ttoast.error('Сессия истекла. Войдите заново.')\r\n\t\t} else if (statusCode >= 400 && !isAuthMe) {\r\n\t\t\t// Показываем ошибку для всех остальных случаев (400, 403, 500)\r\n\t\t\ttoast.error(Array.isArray(message) ? message[0] : message)\r\n\t\t}\r\n\r\n\t\treturn Promise.reject(error)\r\n\t}\r\n)\r\n"],"names":[],"mappings":";;;;AAIU;AAJV;AACA;;;AAEO,MAAM,MAAM,mJAAK,CAAC,MAAM,CAAC;IAC/B,OAAO;IACP,iBAAiB;AAClB;AAEA,IAAI,YAAY,CAAC,QAAQ,CAAC,GAAG,CAC5B,CAAC;IACA,OAAO;AACR,GACA,CAAC;IACA,MAAM,aAAa,MAAM,QAAQ,EAAE;IACnC,MAAM,UACL,YAAY,OAAO,WAAW;IAC/B,MAAM,aAAa,YAAY;IAC/B,MAAM,WAAW,MAAM,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC;IAC3C,IAAI,eAAe,KAAK;QACvB,oJAAK,CAAC,KAAK,CAAC;IACb,OAAO,IAAI,eAAe,OAAO,CAAC,UAAU;QAC3C,oJAAK,CAAC,KAAK,CAAC;IACb,OAAO,IAAI,cAAc,OAAO,CAAC,UAAU;QAC1C,+DAA+D;QAC/D,oJAAK,CAAC,KAAK,CAAC,MAAM,OAAO,CAAC,WAAW,OAAO,CAAC,EAAE,GAAG;IACnD;IAEA,OAAO,QAAQ,MAAM,CAAC;AACvB"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///app/src/shared/api/fetch-with-refresh.ts"],"sourcesContent":["// import { api } from '@/shared/api/base'\r\n// import { toast } from 'sonner'\r\n\r\nimport { api } from './base'\r\n\r\n// export const fetchWithRefresh = async (url: string, options?: any) => {\r\n// \ttry {\r\n// \t\treturn await api.get(url, options)\r\n// \t} catch (err: any) {\r\n// \t\tif (err.response?.status === 401) {\r\n// \t\t\ttry {\r\n// \t\t\t\t// пробуем обновить accessToken\r\n// \t\t\t\tawait api.post('/auth/refresh')\r\n// \t\t\t\treturn await api.get(url, options)\r\n// \t\t\t} catch {\r\n// \t\t\t\ttoast.error('Сессия истекла. Пожалуйста, войдите снова')\r\n// \t\t\t\twindow.location.href = '/login'\r\n// \t\t\t\tthrow err\r\n// \t\t\t}\r\n// \t\t}\r\n// \t\tthrow err\r\n// \t}\r\n// }\r\nlet isRefreshing = false\r\nlet failedQueue: any[] = []\r\n\r\nexport const fetchWithRefresh = async (url: string, options?: any) => {\r\n\ttry {\r\n\t\treturn await api.request({ url, ...options })\r\n\t} catch (err: any) {\r\n\t\tif (err.response?.status === 401 && !isRefreshing) {\r\n\t\t\tisRefreshing = true\r\n\t\t\ttry {\r\n\t\t\t\tconst { data } = await api.post('/auth/refresh') // refresh через HttpOnly куку\r\n\t\t\t\t// обновляем accessToken в api.defaults.headers.Authorization\r\n\t\t\t\tapi.defaults.headers['Authorization'] = `Bearer ${data.accessToken}`\r\n\t\t\t\tisRefreshing = false\r\n\r\n\t\t\t\t// повторяем исходный запрос\r\n\t\t\t\treturn await api.request({ url, ...options })\r\n\t\t\t} catch (refreshErr) {\r\n\t\t\t\tisRefreshing = false\r\n\t\t\t\tthrow refreshErr\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow err\r\n\t}\r\n}\r\n"],"names":[],"mappings":";;;;AAAA,0CAA0C;AAC1C,iCAAiC;AAEjC;;AAEA,0EAA0E;AAC1E,SAAS;AACT,uCAAuC;AACvC,wBAAwB;AACxB,wCAAwC;AACxC,WAAW;AACX,sCAAsC;AACtC,sCAAsC;AACtC,yCAAyC;AACzC,eAAe;AACf,+DAA+D;AAC/D,sCAAsC;AACtC,gBAAgB;AAChB,OAAO;AACP,MAAM;AACN,cAAc;AACd,KAAK;AACL,IAAI;AACJ,IAAI,eAAe;AACnB,IAAI,cAAqB,EAAE;AAEpB,MAAM,mBAAmB,OAAO,KAAa;IACnD,IAAI;QACH,OAAO,MAAM,sIAAG,CAAC,OAAO,CAAC;YAAE;YAAK,GAAG,OAAO;QAAC;IAC5C,EAAE,OAAO,KAAU;QAClB,IAAI,IAAI,QAAQ,EAAE,WAAW,OAAO,CAAC,cAAc;YAClD,eAAe;YACf,IAAI;gBACH,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,sIAAG,CAAC,IAAI,CAAC,iBAAiB,8BAA8B;;gBAC/E,6DAA6D;gBAC7D,sIAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,gBAAgB,GAAG,CAAC,OAAO,EAAE,KAAK,WAAW,EAAE;gBACpE,eAAe;gBAEf,4BAA4B;gBAC5B,OAAO,MAAM,sIAAG,CAAC,OAAO,CAAC;oBAAE;oBAAK,GAAG,OAAO;gBAAC;YAC5C,EAAE,OAAO,YAAY;gBACpB,eAAe;gBACf,MAAM;YACP;QACD;QACA,MAAM;IACP;AACD"}},
    {"offset": {"line": 135, "column": 0}, "map": {"version":3,"sources":["file:///app/app/providers/AuthProvider.tsx"],"sourcesContent":["'use client'\r\n\r\nimport {\r\n\tcreateContext,\r\n\tuseContext,\r\n\tuseEffect,\r\n\tuseState,\r\n\tReactNode,\r\n} from 'react'\r\nimport { api } from '@/shared/api/base'\r\nimport { fetchWithRefresh } from '@/shared/api/fetch-with-refresh'\r\n\r\n// 1. Описываем, какие данные будут доступны в приложении\r\ninterface AuthContextType {\r\n\tuser: any | null\r\n\tsetUser: (user: any) => void\r\n\tlogout: () => Promise<void>\r\n\tisLoading: boolean\r\n}\r\n\r\n// 2. Создаем сам контекст\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\r\n\r\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\r\n\tconst [user, setUser] = useState(null)\r\n\tconst [isLoading, setIsLoading] = useState(true)\r\n\r\n\tuseEffect(() => {\r\n\t\tconst initAuth = async () => {\r\n\t\t\ttry {\r\n\t\t\t\t// fetchWithRefresh автоматически обновит accessToken, если нужно\r\n\t\t\t\tconst { data } = await fetchWithRefresh('/auth/me')\r\n\t\t\t\tsetUser(data)\r\n\t\t\t} catch (e) {\r\n\t\t\t\tsetUser(null)\r\n\t\t\t} finally {\r\n\t\t\t\tsetIsLoading(false)\r\n\t\t\t}\r\n\t\t}\r\n\t\tinitAuth()\r\n\t}, [])\r\n\r\n\tconst logout = async () => {\r\n\t\ttry {\r\n\t\t\tawait api.post('/auth/logout')\r\n\t\t\tsetUser(null)\r\n\t\t\twindow.location.href = '/login'\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error('Logout failed', e)\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<AuthContext.Provider value={{ user, setUser, logout, isLoading }}>\r\n\t\t\t{children}\r\n\t\t</AuthContext.Provider>\r\n\t)\r\n}\r\n\r\n// 3. Создаем хук для удобного использования в компонентах\r\nexport const useAuth = () => {\r\n\tconst context = useContext(AuthContext)\r\n\tif (context === undefined) {\r\n\t\tthrow new Error('useAuth must be used within an AuthProvider')\r\n\t}\r\n\treturn context\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AAOA;AACA;;;AAVA;;;;AAoBA,0BAA0B;AAC1B,MAAM,4BAAc,IAAA,8KAAa,EAA8B;AAExD,MAAM,eAAe,CAAC,EAAE,QAAQ,EAA2B;;IACjE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAE3C,IAAA,0KAAS;kCAAC;YACT,MAAM;mDAAW;oBAChB,IAAI;wBACH,iEAAiE;wBACjE,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,uKAAgB,EAAC;wBACxC,QAAQ;oBACT,EAAE,OAAO,GAAG;wBACX,QAAQ;oBACT,SAAU;wBACT,aAAa;oBACd;gBACD;;YACA;QACD;iCAAG,EAAE;IAEL,MAAM,SAAS;QACd,IAAI;YACH,MAAM,sIAAG,CAAC,IAAI,CAAC;YACf,QAAQ;YACR,OAAO,QAAQ,CAAC,IAAI,GAAG;QACxB,EAAE,OAAO,GAAG;YACX,QAAQ,KAAK,CAAC,iBAAiB;QAChC;IACD;IAEA,qBACC,6LAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAS;YAAQ;QAAU;kBAC9D;;;;;;AAGJ;GAlCa;KAAA;AAqCN,MAAM,UAAU;;IACtB,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QAC1B,MAAM,IAAI,MAAM;IACjB;IACA,OAAO;AACR;IANa"}}]
}